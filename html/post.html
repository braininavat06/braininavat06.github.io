<!DOCTYPE html>
<html lang="kor">
<head>
    <div id="head"></div>
    <title>Medimory | 메디모리 글 쓰기</title>
    <link rel="stylesheet" href="../css/post.css">

    <link rel="stylesheet" href="../css/ckeditor.css">
	<link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/43.1.0/ckeditor5.css">
</head>
<body>
    <nav id="nav"></nav>
    <div class="section_package">
        <aside id="aside"></aside>
        <section id="section">
            <div class="section_box">
                <div class="1 sectionBody">
                    <h1>글 작성</h1>
                    <hr>
                    <div class="inputBody">
                        <h3>제목 : </h3><input type="text" id="title">
                    </div><br>
                    <div class="inputBody">
                        <h3>암호 : </h3><input type="password" id="password">
                    </div><br>
                    <div class="main-container">
                        <div class="editor-container editor-container_classic-editor" id="editor-container">
                            <div class="editor-container__editor">
                                <div id="editor">
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <button id="submit">작성 완료</button>
                </div>
            </div>
        </section>
    </div>
    <footer id="footer"></footer>

    <script type="importmap">
		{
			"imports": {
				"ckeditor5": "https://cdn.ckeditor.com/ckeditor5/43.1.0/ckeditor5.js",
				"ckeditor5/": "https://cdn.ckeditor.com/ckeditor5/43.1.0/"
			}
		}
    </script>
    
    <script type="module" src="../js/ckeditor.js"></script>

    <script type="module">
        import { htmlModule } from "../js/htmlModule.js";
        import { Editor } from "ckeditor5";

        document.getElementById("head").innerHTML = htmlModule.head;
        document.getElementById("nav").innerHTML = htmlModule.nav;
        document.getElementById("aside").innerHTML = htmlModule.aside;
        document.getElementById("footer").innerHTML = htmlModule.footer;

        document.getElementById("submit").addEventListener("click", () => {
        var title = document.getElementById("title").value;
        var password = document.getElementById("password").value;
        var content = currentEditor.getData();

        async function makeRequest(title, content){
            var requestBody = {
                "title" : title,
                "content" : content
            }
            return JSON.stringify(requestBody);
        }
        
        async function writePage() {
            var requestBody = await makeRequest(title, content);
            fetch("https://www.medimory.com/api/v1/post_process", {
					method : "POST",
					body : requestBody
				})
					.then((response) => console.log(response))
					.catch(() => {console.log("글 업로드에 실패했습니다.")});
        }

        if(title.value == 0) {
            alert("제목을 입력하세요.");
            return;
        }

        fetch("https://www.medimory.com/api/v1/password_check", {
            method: "POST",
            body: password
        })
            .then((response) => {
                return response.text();
            })
            .then((data) => {
                if(data == "success") {
                    writePage(title, content);
                } else {
                    alert("비밀번호가 일치하지 않습니다.")
                }
            })
            .catch(() => {console.log("알 수 없는 오류");})

    });
    </script>
</body>
</html>